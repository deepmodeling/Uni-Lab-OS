# BioyondCellWorkstation JSON é…ç½®è¿ç§»ç»éªŒæ€»ç»“

**æ—¥æœŸ**: 2026-01-13  
**ç›®çš„**: ä» `config.py` è¿ç§»åˆ° JSON é…ç½®æ–‡ä»¶

---

## é—®é¢˜èƒŒæ™¯

åŸç³»ç»Ÿé€šè¿‡ `config.py` ç®¡ç†é…ç½®ï¼Œå¯¼è‡´ï¼š
1. HTTP æœåŠ¡é‡å¤å¯åŠ¨ï¼ˆçˆ¶ç±» `BioyondWorkstation` å’Œå­ç±»éƒ½å¯åŠ¨ï¼‰
2. é…ç½®åˆ†æ•£åœ¨ä»£ç ä¸­ï¼Œä¸ä¾¿äºç®¡ç†
3. æ— æ³•é€šè¿‡ JSON ç»Ÿä¸€é…ç½®æ‰€æœ‰å‚æ•°

---

## è§£å†³æ–¹æ¡ˆï¼šåµŒå¥—é…ç½®ç»“æ„

### JSON ç»“æ„è®¾è®¡

**æ­£ç¡®ç¤ºä¾‹** (åµŒå¥—åœ¨ `config` ä¸­):
```json
{
  "nodes": [{
    "id": "bioyond_cell_workstation",
    "config": {
      "deck": {...},
      "protocol_type": [],
      "bioyond_config": {
        "api_host": "http://172.16.11.219:44388",
        "api_key": "8A819E5C",
        "timeout": 30,
        "HTTP_host": "172.16.11.206",
        "HTTP_port": 8080,
        "debug_mode": false,
        "material_type_mappings": {...},
        "warehouse_mapping": {...},
        "solid_liquid_mappings": {...}
      }
    },
    "data": {}
  }]
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… `bioyond_config` æ”¾åœ¨ `config` ä¸­ï¼ˆä¼šä¼ é€’åˆ° `__init__`ï¼‰
- âŒ **ä¸è¦**æ”¾åœ¨ `data` ä¸­ï¼ˆ`data` æ˜¯è¿è¡Œæ—¶çŠ¶æ€ï¼Œä¸ä¼šä¼ é€’ï¼‰

---

## Python ä»£ç é€‚é…

### 1. ä¿®æ”¹ `BioyondCellWorkstation.__init__` ç­¾å

**æ–‡ä»¶**: `bioyond_cell_workstation.py`

```python
def __init__(self, bioyond_config: dict = None, deck=None, protocol_type=None, **kwargs):
    """
    Args:
        bioyond_config: ä» JSON åŠ è½½çš„é…ç½®å­—å…¸
        deck: Deck é…ç½®
        protocol_type: åè®®ç±»å‹
    """
    # éªŒè¯é…ç½®
    if bioyond_config is None:
        raise ValueError("éœ€è¦ bioyond_config å‚æ•°")
    
    # ä¿å­˜é…ç½®
    self.bioyond_config = bioyond_config
    
    # è®¾ç½® HTTP æœåŠ¡å»é‡æ ‡å¿—
    self.bioyond_config["_disable_auto_http_service"] = True
    
    # è°ƒç”¨çˆ¶ç±»
    super().__init__(bioyond_config=self.bioyond_config, deck=deck, **kwargs)
```

### 2. æ›¿æ¢å…¨å±€å˜é‡å¼•ç”¨

**ä¿®æ”¹å‰**ï¼ˆä½¿ç”¨å…¨å±€å˜é‡ï¼‰:
```python
from config import MATERIAL_TYPE_MAPPINGS, WAREHOUSE_MAPPING

def create_sample(self, board_type, ...):
    carrier_type_id = MATERIAL_TYPE_MAPPINGS[board_type][1]
    location_id = WAREHOUSE_MAPPING[warehouse_name]["site_uuids"][location_code]
```

**ä¿®æ”¹å**ï¼ˆä»é…ç½®è¯»å–ï¼‰:
```python
def create_sample(self, board_type, ...):
    carrier_type_id = self.bioyond_config['material_type_mappings'][board_type][1]
    location_id = self.bioyond_config['warehouse_mapping'][warehouse_name]["site_uuids"][location_code]
```

### 3. ä¿®å¤çˆ¶ç±»é…ç½®è®¿é—®

åœ¨ `station.py` ä¸­å®‰å…¨è®¿é—®é…ç½®é»˜è®¤å€¼ï¼š

```python
# ä¿®æ”¹å‰ï¼ˆä¼š KeyErrorï¼‰
self._http_service_config = {
    "host": bioyond_config.get("http_service_host", HTTP_SERVICE_CONFIG["http_service_host"])
}

# ä¿®æ”¹åï¼ˆå®‰å…¨è®¿é—®ï¼‰
self._http_service_config = {
    "host": bioyond_config.get("http_service_host", HTTP_SERVICE_CONFIG.get("http_service_host", ""))
}
```

---

## å¸¸è§é™·é˜±

### âŒ é”™è¯¯1ï¼šå°†é…ç½®æ”¾åœ¨ `data` å­—æ®µ
```json
"config": {"deck": {...}},
"data": {"bioyond_config": {...}}  // âŒ ä¸ä¼šä¼ é€’åˆ° __init__
```

### âŒ é”™è¯¯2ï¼šæ‰å¹³åŒ–é…ç½®ï¼ˆå·²åºŸå¼ƒæ–¹æ¡ˆï¼‰
è™½ç„¶æ‰å¹³åŒ–ä¹Ÿèƒ½å·¥ä½œï¼Œä½†ä¸æ¨èï¼š
```json
"config": {
  "deck": {...},
  "api_host": "...",     // âŒ ä¸å¤Ÿæ¸…æ™°
  "api_key": "...",
  "HTTP_host": "..."
}
```

### âŒ é”™è¯¯3ï¼šå¿˜è®°æ›¿æ¢å…¨å±€å˜é‡å¼•ç”¨
ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ `MATERIAL_TYPE_MAPPINGS` ç­‰å…¨å±€å˜é‡ä¼šå¯¼è‡´ `NameError`ã€‚

---

## äº‘ç«¯åŒæ­¥æ³¨æ„äº‹é¡¹

ä½¿ç”¨ `--upload_registry` æ—¶ï¼Œäº‘ç«¯é…ç½®å¯èƒ½è¦†ç›–æœ¬åœ°é…ç½®ï¼š
- é¦–æ¬¡ä¸Šä¼ æ—¶ç¡®ä¿ JSON å®Œæ•´
- æˆ–ä½¿ç”¨æ–°çš„ `ak/sk` é¿å…æ—§é…ç½®å¹²æ‰°
- è°ƒè¯•æ—¶å¯æš‚æ—¶ç§»é™¤ `--upload_registry` å‚æ•°

---

## éªŒè¯æ¸…å•

å¯åŠ¨æˆåŠŸååº”çœ‹åˆ°ï¼š
```
âœ… ä» JSON é…ç½®åŠ è½½ bioyond_config æˆåŠŸ
   API Host: http://...
   HTTP Service: ...
âœ… BioyondCellWorkstation åˆå§‹åŒ–å®Œæˆ
Loaded ResourceTreeSet with ... nodes
```

è¿è¡Œæ—¶ä¸åº”å‡ºç°ï¼š
- âŒ `NameError: name 'MATERIAL_TYPE_MAPPINGS' is not defined`
- âŒ `KeyError: 'http_service_host'`
- âŒ `bioyond_config ç¼ºå°‘å¿…éœ€å‚æ•°`

---

## è°ƒè¯•ç»éªŒ

1. **æ·»åŠ è°ƒè¯•æ—¥å¿—**æŸ¥çœ‹å‚æ•°ä¼ é€’é“¾è·¯ï¼š
   - `graphio.py`: JSON åŠ è½½åçš„ config å†…å®¹
   - `initialize_device.py`: `device_config.res_content.config` çš„é”®
   - `bioyond_cell_workstation.py`: `__init__` æ¥æ”¶åˆ°çš„å‚æ•°

2. **config vs data åŒºåˆ«**ï¼š
   - `config`: åˆå§‹åŒ–å‚æ•°ï¼Œä¼ é€’ç»™ `__init__`
   - `data`: è¿è¡Œæ—¶çŠ¶æ€ï¼Œä¸ä¼ é€’ç»™ `__init__`

3. **å‚æ•°åå¿…é¡»åŒ¹é…**ï¼š
   - JSON ä¸­çš„é”®åå¿…é¡»ä¸ `__init__` å‚æ•°åå®Œå…¨ä¸€è‡´

4. **è°ƒè¯•ä»£ç æ¸…ç†**ï¼šå®Œæˆåè®°å¾—åˆ é™¤è°ƒè¯•æ—¥å¿—ï¼ˆğŸ” DEBUG æ ‡è®°ï¼‰

---

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `yibin_electrolyte_config.json` | åˆ›å»ºåµŒå¥— `config.bioyond_config` ç»“æ„ |
| `bioyond_cell_workstation.py` | ä¿®æ”¹ `__init__` æ¥æ”¶ `bioyond_config`ï¼Œæ›¿æ¢æ‰€æœ‰å…¨å±€å˜é‡å¼•ç”¨ |
| `station.py` | å®‰å…¨è®¿é—® `HTTP_SERVICE_CONFIG` é»˜è®¤å€¼ |

---

## å‚è€ƒä»£ç ä½ç½®

- JSON é…ç½®ç¤ºä¾‹: `yibin_electrolyte_config.json` L12-L353
- `__init__` å®ç°: `bioyond_cell_workstation.py` L39-L94
- å…¨å±€å˜é‡æ›¿æ¢ç¤ºä¾‹: `bioyond_cell_workstation.py` L2005, L1863, L1966
- HTTP æœåŠ¡é…ç½®: `station.py` L629-L634

---

**æ€»ç»“**: ä½¿ç”¨åµŒå¥—ç»“æ„å°†æ‰€æœ‰é…ç½®æ”¾åœ¨ `config.bioyond_config` ä¸­ï¼Œä¿®æ”¹ `__init__` ç›´æ¥æ¥æ”¶è¯¥å‚æ•°ï¼Œå¹¶æ›¿æ¢æ‰€æœ‰å…¨å±€å˜é‡å¼•ç”¨ä¸º `self.bioyond_config` è®¿é—®ã€‚
